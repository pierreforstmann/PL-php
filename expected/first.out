--
-- Base functionality.
--
create extension plphp;
-- Basic things: scalars and arrays.
CREATE FUNCTION test_void() RETURNS integer
LANGUAGE plphp AS $$
	return;
$$;
SELECT test_void();
 test_void 
-----------
          
(1 row)

CREATE FUNCTION test_an_int() RETURNS integer
LANGUAGE plphp AS $$
	return 1;
$$;
SELECT test_an_int();
 test_an_int 
-------------
           1
(1 row)

SELECT * FROM test_an_int();
 test_an_int 
-------------
           1
(1 row)

CREATE FUNCTION test_an_array() RETURNS int[]
LANGUAGE plphp AS $$
	return array(1);
$$;
SELECT test_an_array();
 test_an_array 
---------------
 {1}
(1 row)

SELECT * FROM test_an_array();
 test_an_array 
---------------
 {1}
(1 row)

CREATE FUNCTION test_a_bogus_array() RETURNS int[]
LANGUAGE plphp AS $$
	return 1;
$$;
SELECT test_a_bogus_array();
ERROR:  function declared to return array must return an array
SELECT * FROM test_a_bogus_array();
ERROR:  function declared to return array must return an array
CREATE FUNCTION test_a_bogus_int() RETURNS integer
LANGUAGE plphp AS $$
	return array(1);
$$;
SELECT test_a_bogus_int();
ERROR:  this plphp function cannot return arrays
SELECT * FROM test_a_bogus_int();
ERROR:  this plphp function cannot return arrays
CREATE FUNCTION test_ndim_array(int, int) RETURNS int[]
LANGUAGE plphp AS $$
    if (!function_exists('bar')) {
    function bar($a, $b) {
        if ($a == 1) {
            return array($b, $b+1);
        }
        return array(bar($a-1, $b), bar($a-1, $b+1));
    }
    }

    $return = bar($args[0], $args[1]);
    return $return;
$$;
